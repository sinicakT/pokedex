{% extends "index.html" %}

{% block title %}Pok√©mons{% endblock %}

{% block content %}
    <!-- Search Form -->
    <form method="get" class="mb-6 space-y-4">
        <div class="flex flex-wrap items-center gap-4">
            <input type="text" name="search" value="{{ request.GET.search }}" placeholder="Search by name"
                   class="border px-3 py-2 rounded w-full md:w-2/3 flex-1">

            <button type="submit" class="px-4 py-2 rounded text-blue-500 hover:text-blue-700 text-2xl">
                <i class="fa-solid fa-magnifying-glass"></i>
            </button>

            {% if request.GET.search or request.GET.view or request.GET.type %}
                <a href="{% url 'pokemon-list' %}"
                   class="text-red-500 hover:text-red-700 text-3xl px-2">
                    <i class="fa-solid fa-xmark"></i>
                </a>
            {% endif %}
        </div>

        <div class="w-full flex flex-wrap justify-between items-center gap-4">
            <div class="w-full md:w-1/3">
                <select name="type" id="type"
                        class="w-full bg-white border px-3 py-2 rounded text-sm">
                    <option value="" class="text-gray-500">Select type</option>
                    {% for type_id, type_name in types.items %}
                        <option value="{{ type_id }}"
                                {% if request.GET.type == type_id|stringformat:"s" %}selected{% endif %}>
                            {{ type_name|title }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            <div class="flex justify-end">
                {% with current_view=request.GET.view|default:"card" %}
                    {% if current_view == "card" %}
                        <a href="?{% if request.GET.search %}search={{ request.GET.search }}&{% endif %}{% if request.GET.page %}page={{ request.GET.page }}&{% endif %}view=table"
                           class="text-grey rounded flex items-center gap-2 p-4 mr-6">
                            <i class="fas fa-list fa-lg"></i>
                        </a>
                    {% else %}
                        <a href="?{% if request.GET.search %}search={{ request.GET.search }}&{% endif %}{% if request.GET.page %}page={{ request.GET.page }}{% endif %}"
                           class="text-grey rounded flex items-center gap-2 p-4 mr-6">
                            <i class="fas fa-th-large fa-lg"></i>
                        </a>
                    {% endif %}
                {% endwith %}
            </div>
        </div>
    </form>

    {% if view_mode == "table" %}
        <!-- Table View -->
        {% include "pokemon/partials/table_view.html" with pokemons=pokemons %}
    {% else %}
        <!-- Card View -->
        {% include "pokemon/partials/card_view.html" with pokemons=pokemons %}
    {% endif %}

    <!-- Pagination -->
    <div class="mt-6 flex justify-center space-x-2">
        {% if page_obj.has_previous %}
            <a href="?page={ page_obj.previous_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.view %}&view={{ request.GET.view }}{% endif %}{% if request.GET.type %}&type={{ request.GET.type }}{% endif %}"
               class="px-3 py-1 bg-gray-300 rounded">Previous</a>
        {% endif %}

        <span class="px-3 py-1 bg-gray-200 rounded">Page {{ page_obj.number }} of {{ paginator.num_pages }}</span>

        {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.view %}&view={{ request.GET.view }}{% endif %}{% if request.GET.type %}&type={{ request.GET.type }}{% endif %}"
               class="px-3 py-1 bg-gray-300 rounded">Next</a>
        {% endif %}
    </div>

{% endblock %}

{% block js_scripts %}
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const typeSelect = document.getElementById("type");
            if (typeSelect) {
                typeSelect.addEventListener("change", function () {
                    const form = this.closest("form");
                    if (form) {
                        form.submit();
                    }
                });
            }
        });
    </script>
{% endblock %}

